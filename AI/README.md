# Compiling with CMake

To see the available presets:

    cmake --list-presets

To create a new build directory for one of the presets (for example, release):

    cmake --preset release

Each preset creates a new folder starting with "build\_" (such as build_release) with an autogenerated makefile. To compile do

    cd build_release
    make

You can also use `make VERBOSE=1` to see the actual commands executed by make.
In the future you only have to run make, there is no need to rerun cmake.

## Presets

- The `debug` and `release` presets use the default compiler and default settings in your system. The `debug` preset enables many correctness checks that make the program very slow. The `release` preset uses the "-NDEBUG" flag to leave out all the correctness checks. It also uses flags such as "-flto=full" to optimize performance.
- The `debug-clang` and `release-clang` presets explicitly request the clang compiler, in case it is not the default in your system.
- The `analysis-clang` preset creates a Makefile that runs the clang static analysis. It is slow to compile and does not generate an executable, but it can give more more specialized warnings than usual.
- The `debug-emcc` and `release-emcc` use the emscripten compiler to generate WebAssembly.

## Running WebAssembly

First, run the emscripten compiler:

    cmake --preset release-emcc
    cd release-emcc
    make

In order to run the output generated by emcc (`wallwars_ai.html`), you typically cannot just open
the file in your browser for security reasons. Instead you need to run a small web server. EMCC
comes with `emrun` which does exactly that. Do

    emrun wallwars_ai.html

to open the web assembly code in your browser.
